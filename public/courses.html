<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>!Graduated</title>
  <link rel="stylesheet" href="stylesheets/index.css" />
  <link rel="stylesheet" href="stylesheets/courses.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml" />
  <script src="javascripts/index.js"></script>
  <script src="javascripts/results.js"></script>

</head>

<body onload="checkLoginStatus(); init()">
  <div id="app" class="app">
    <nav class="navbar">
      <a href="/" class="logo">!Graduated</a>
      <div class="navbar-right">
        <div class="nav-tabs" id="tabs">
          <button class="nav-btn" onclick="goHome()">Home</button>
          <button class="nav-btn" onclick="goSaved()">Saved</button>
          <button class="nav-btn" onclick="goProfile()">Profile</button>
        </div>
        <a href="/courses.html" id="course-btn" class="auth-btn">Courses</a>
        <a href="/signin" id="login-btn" class="auth-btn login-btn">Log In</a>
        <a href="/signout" id="logout-btn" class="auth-btn hidden">Log Out</a>
      </div>
    </nav>

    <div id="courses" style="padding: 40px 20px 40px;" class="page">
      <div class="container">
        <h2>All Courses</h2>
        <div id="courses-results" class="card-grid"></div>
        <!-- Review Section Starts Here -->
        <!-- <div id="reviewForm" class="review-form hidden">
          <textarea id="reviewText" placeholder="Write your review..." rows="4"></textarea>
          <button onclick="submitReview()">Submit</button>
        </div>

          <div class="review-list" id="review-list">
            <div class="review-item">
              <p class="review-text"></p>
              <p class="review-author"></p>
            </div>
          </div>
        </div> -->
        <!-- Review Section Ends Here -->

      </div>
    </div>

    <script>
      async function init() {
        console.log("in allcourses init");
        document.getElementById("courses-results").innerText = "Loading...";

        const courses = await fetch('api/v1/course');
        const coursesJson = await courses.json();

        const identityRes = await fetch("api/v1/user/myIdentity");
        const identity = await identityRes.json();
        const isBookmarked = identity.status == 'loggedin' ? identity.userInfo.savedCourses: null
 
        document.getElementById("courses-results").innerHTML = Array.isArray(courseJson) && courseJson.length > 0
          ? (coursesJson.map(course =>
            `
              <div class="card" id="${course.courseId}" style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between;">
                  <h3>${course.courseId}: ${course.courseTitle}</h3>
                  ${isBookmarked ?
                (isBookmarked.includes(course.courseId) ?
                `<button style="background-color: #e6e6fa;" onclick="toggleBookmark('${course.courseId}')"> <img src="img/bookmark-fill.svg"> </button>`
                : `<button style="background-color: #e6e6fa;" onclick="toggleBookmark('${course.courseId}')"> <img src='img/bookmark.svg'> </button>`)
                : ""}
                </div>
                <p>College: ${course.courseCollege}</p>
                <p>Credits: ${course.credits}</p>
                <button onclick="selectCourse('${course.courseId}')"> View Course </button>
              </div>
            `
          )).join("")
          : `<p>No courses in databse</p>`;
      }

      async function selectCourse(id) {
        console.log("selectCourse");
        location.href = `/course_detail.html?course=${id}`;
      }
    </script>
  </div>
</body>
</html>